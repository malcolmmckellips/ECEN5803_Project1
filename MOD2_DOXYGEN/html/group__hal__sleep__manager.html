<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Module 2: Sleep manager API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Module 2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__hal__sleep__manager.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Sleep manager API<div class="ingroups"><a class="el" href="group__platform.html">Platform</a> &raquo; <a class="el" href="group__platform__power__mgmt.html">Power management functions</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The sleep manager provides API to automatically select sleep mode.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__hal__sleep__manager__tests"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hal__sleep__manager__tests.html">Sleep manager API tests</a></td></tr>
<tr class="memdesc:group__hal__sleep__manager__tests"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tests to validate the proper implementation of the sleep manager. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga1ff1c9aa2900e206cd983a2311217448"><td class="memItemLeft" align="right" valign="top"><a id="ga1ff1c9aa2900e206cd983a2311217448"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>sleep_manager_lock_deep_sleep</b>()&#160;&#160;&#160;<a class="el" href="group__hal__sleep__manager.html#gad715f9f3ef9adf16dbb55279543b0004">sleep_manager_lock_deep_sleep_internal</a>()</td></tr>
<tr class="separator:ga1ff1c9aa2900e206cd983a2311217448"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga10df1aab1191158adbb1a0f1caae3018"><td class="memItemLeft" align="right" valign="top"><a id="ga10df1aab1191158adbb1a0f1caae3018"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>sleep_manager_unlock_deep_sleep</b>()&#160;&#160;&#160;<a class="el" href="group__hal__sleep__manager.html#gade396fc8b2e9c58cb67163e79605f7da">sleep_manager_unlock_deep_sleep_internal</a>()</td></tr>
<tr class="separator:ga10df1aab1191158adbb1a0f1caae3018"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gad715f9f3ef9adf16dbb55279543b0004"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hal__sleep__manager.html#gad715f9f3ef9adf16dbb55279543b0004">sleep_manager_lock_deep_sleep_internal</a> (void)</td></tr>
<tr class="separator:gad715f9f3ef9adf16dbb55279543b0004"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gade396fc8b2e9c58cb67163e79605f7da"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hal__sleep__manager.html#gade396fc8b2e9c58cb67163e79605f7da">sleep_manager_unlock_deep_sleep_internal</a> (void)</td></tr>
<tr class="separator:gade396fc8b2e9c58cb67163e79605f7da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaaf833e584ba11ffe8dc0985626d6e7d9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hal__sleep__manager.html#gaaf833e584ba11ffe8dc0985626d6e7d9">sleep_manager_can_deep_sleep</a> (void)</td></tr>
<tr class="separator:gaaf833e584ba11ffe8dc0985626d6e7d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab37d67f74d29612523b0694c9aef083b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hal__sleep__manager.html#gab37d67f74d29612523b0694c9aef083b">sleep_manager_can_deep_sleep_test_check</a> (void)</td></tr>
<tr class="separator:gab37d67f74d29612523b0694c9aef083b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeb0be61033850f64b0b139ed497c011c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hal__sleep__manager.html#gaeb0be61033850f64b0b139ed497c011c">sleep_manager_sleep_auto</a> (void)</td></tr>
<tr class="separator:gaeb0be61033850f64b0b139ed497c011c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae79880aeea2aa6beb5e77c9e02d17cd3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__hal.html#gafbbb0a24d16addef2bc749c63e2a7f0f">us_timestamp_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hal__sleep__manager.html#gae79880aeea2aa6beb5e77c9e02d17cd3">mbed_time_sleep</a> (void)</td></tr>
<tr class="separator:gae79880aeea2aa6beb5e77c9e02d17cd3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2ab2a21c6c029a63f5a13b2b54430880"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__hal.html#gafbbb0a24d16addef2bc749c63e2a7f0f">us_timestamp_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hal__sleep__manager.html#ga2ab2a21c6c029a63f5a13b2b54430880">mbed_time_deepsleep</a> (void)</td></tr>
<tr class="separator:ga2ab2a21c6c029a63f5a13b2b54430880"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga12f7b28ebcd92b6d5abf8e4f6ce9fb15"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__hal.html#gafbbb0a24d16addef2bc749c63e2a7f0f">us_timestamp_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hal__sleep__manager.html#ga12f7b28ebcd92b6d5abf8e4f6ce9fb15">mbed_time_idle</a> (void)</td></tr>
<tr class="separator:ga12f7b28ebcd92b6d5abf8e4f6ce9fb15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab99c6722169652a701d1b8d18e65887f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__hal.html#gafbbb0a24d16addef2bc749c63e2a7f0f">us_timestamp_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hal__sleep__manager.html#gab99c6722169652a701d1b8d18e65887f">mbed_uptime</a> (void)</td></tr>
<tr class="separator:gab99c6722169652a701d1b8d18e65887f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The sleep manager provides API to automatically select sleep mode. </p>
<p>There are two sleep modes:</p><ul>
<li>sleep</li>
<li>deepsleep</li>
</ul>
<p>Use locking/unlocking deepsleep for drivers that depend on features that are not allowed (=disabled) during the deepsleep. For instance, high frequency clocks.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Defined behavior</h1>
<ul>
<li>The lock is a counter</li>
<li>The lock can be locked up to USHRT_MAX - Verified by ::test_lock_eq_ushrt_max</li>
<li>The lock has to be equally unlocked as locked - Verified by ::test_lock_eq_ushrt_max</li>
<li>The function <a class="el" href="group__hal__sleep__manager.html#gad715f9f3ef9adf16dbb55279543b0004">sleep_manager_lock_deep_sleep_internal()</a> locks the automatic deep mode selection - Verified by ::test_lock_unlock</li>
<li>The function <a class="el" href="group__hal__sleep__manager.html#gade396fc8b2e9c58cb67163e79605f7da">sleep_manager_unlock_deep_sleep_internal()</a> unlocks the automatic deep mode selection - Verified by ::test_lock_unlock</li>
<li>The function <a class="el" href="group__hal__sleep__manager.html#gaeb0be61033850f64b0b139ed497c011c">sleep_manager_sleep_auto()</a> chooses the sleep or deep sleep modes based on the lock - Verified by ::test_sleep_auto</li>
<li>The function <a class="el" href="group__hal__sleep__manager.html#gad715f9f3ef9adf16dbb55279543b0004">sleep_manager_lock_deep_sleep_internal()</a> is IRQ and thread safe - Verified by ::sleep_manager_multithread_test and ::sleep_manager_irq_test</li>
<li>The function <a class="el" href="group__hal__sleep__manager.html#gade396fc8b2e9c58cb67163e79605f7da">sleep_manager_unlock_deep_sleep_internal()</a> is IRQ and thread safe - Verified by ::sleep_manager_multithread_test and ::sleep_manager_irq_test</li>
<li>The function <a class="el" href="group__hal__sleep__manager.html#gaeb0be61033850f64b0b139ed497c011c">sleep_manager_sleep_auto()</a> is IRQ and thread safe</li>
</ul>
<p>Example: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> driver::handler()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (_sensor.get_event()) {</div>
<div class="line">        <span class="comment">// any event - we are finished, unlock the deepsleep</span></div>
<div class="line">        sleep_manager_unlock_deep_sleep();</div>
<div class="line">        _callback();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> driver::measure(event_t event, callback_t&amp; <a class="code" href="group__platform___callback.html#ga996d0526ad2417ca8568c2ee02fda826">callback</a>)</div>
<div class="line">{</div>
<div class="line">     _callback = <a class="code" href="group__platform___callback.html#ga996d0526ad2417ca8568c2ee02fda826">callback</a>;</div>
<div class="line">     sleep_manager_lock_deep_sleep();</div>
<div class="line">     <span class="comment">// start async transaction, we are waiting for an event</span></div>
<div class="line">     <span class="keywordflow">return</span> _sensor.start(event, <a class="code" href="group__platform___callback.html#ga996d0526ad2417ca8568c2ee02fda826">callback</a>);</div>
<div class="line">}</div>
</div><!-- fragment --> <h2 class="groupheader">Function Documentation</h2>
<a id="ga2ab2a21c6c029a63f5a13b2b54430880"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2ab2a21c6c029a63f5a13b2b54430880">&#9670;&nbsp;</a></span>mbed_time_deepsleep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__hal.html#gafbbb0a24d16addef2bc749c63e2a7f0f">us_timestamp_t</a> mbed_time_deepsleep </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Provides the time spent in deep sleep mode since boot.</p>
<dl class="section return"><dt>Returns</dt><dd>Time spent in deep sleep </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Works only if platform supports LP ticker. </dd></dl>

</div>
</div>
<a id="ga12f7b28ebcd92b6d5abf8e4f6ce9fb15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga12f7b28ebcd92b6d5abf8e4f6ce9fb15">&#9670;&nbsp;</a></span>mbed_time_idle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__hal.html#gafbbb0a24d16addef2bc749c63e2a7f0f">us_timestamp_t</a> mbed_time_idle </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Provides the time spent in idle mode since boot.</p>
<dl class="section return"><dt>Returns</dt><dd>Idle thread time. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Works only if platform supports LP ticker. </dd></dl>

</div>
</div>
<a id="gae79880aeea2aa6beb5e77c9e02d17cd3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae79880aeea2aa6beb5e77c9e02d17cd3">&#9670;&nbsp;</a></span>mbed_time_sleep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__hal.html#gafbbb0a24d16addef2bc749c63e2a7f0f">us_timestamp_t</a> mbed_time_sleep </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Provides the time spent in sleep mode since boot.</p>
<dl class="section return"><dt>Returns</dt><dd>Time spent in sleep </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Works only if platform supports LP ticker. </dd></dl>

</div>
</div>
<a id="gab99c6722169652a701d1b8d18e65887f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab99c6722169652a701d1b8d18e65887f">&#9670;&nbsp;</a></span>mbed_uptime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__hal.html#gafbbb0a24d16addef2bc749c63e2a7f0f">us_timestamp_t</a> mbed_uptime </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Provides the time since the system is up i.e. boot.</p>
<dl class="section return"><dt>Returns</dt><dd>System uptime. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>Works only if platform supports LP ticker. </dd></dl>

</div>
</div>
<a id="gaaf833e584ba11ffe8dc0985626d6e7d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaaf833e584ba11ffe8dc0985626d6e7d9">&#9670;&nbsp;</a></span>sleep_manager_can_deep_sleep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sleep_manager_can_deep_sleep </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the status of deep sleep allowance for a target</p>
<dl class="section return"><dt>Returns</dt><dd>true if a target can go to deepsleep, false otherwise </dd></dl>

</div>
</div>
<a id="gab37d67f74d29612523b0694c9aef083b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab37d67f74d29612523b0694c9aef083b">&#9670;&nbsp;</a></span>sleep_manager_can_deep_sleep_test_check()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sleep_manager_can_deep_sleep_test_check </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check if the target can deep sleep within a period of time</p>
<p>This function in intended for use in testing. The amount of time this functions waits for deeps sleep to be available is currently 2ms. This may change in the future depending on testing requirements.</p>
<dl class="section return"><dt>Returns</dt><dd>true if a target can go to deepsleep, false otherwise </dd></dl>

</div>
</div>
<a id="gad715f9f3ef9adf16dbb55279543b0004"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad715f9f3ef9adf16dbb55279543b0004">&#9670;&nbsp;</a></span>sleep_manager_lock_deep_sleep_internal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sleep_manager_lock_deep_sleep_internal </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Lock the deep sleep mode</p>
<p>This locks the automatic deep mode selection. <a class="el" href="group__hal__sleep__manager.html#gaeb0be61033850f64b0b139ed497c011c">sleep_manager_sleep_auto()</a> will ignore deepsleep mode if this function is invoked at least once (the internal counter is non-zero)</p>
<p>Use this locking mechanism for interrupt driven API that are running in the background and deepsleep could affect their functionality</p>
<p>The lock is a counter, can be locked up to USHRT_MAX This function is IRQ and thread safe </p>

</div>
</div>
<a id="gaeb0be61033850f64b0b139ed497c011c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaeb0be61033850f64b0b139ed497c011c">&#9670;&nbsp;</a></span>sleep_manager_sleep_auto()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sleep_manager_sleep_auto </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enter auto selected sleep mode. It chooses the sleep or deepsleep modes based on the deepsleep locking counter</p>
<p>This function is IRQ and thread safe</p>
<dl class="section note"><dt>Note</dt><dd>If MBED_DEBUG is defined, only hal_sleep is allowed. This ensures the debugger to be active for debug modes. </dd></dl>

</div>
</div>
<a id="gade396fc8b2e9c58cb67163e79605f7da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gade396fc8b2e9c58cb67163e79605f7da">&#9670;&nbsp;</a></span>sleep_manager_unlock_deep_sleep_internal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sleep_manager_unlock_deep_sleep_internal </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unlock the deep sleep mode</p>
<p>Use unlocking in pair with sleep_manager_lock_deep_sleep().</p>
<p>The lock is a counter, should be equally unlocked as locked This function is IRQ and thread safe </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__platform___callback_html_ga996d0526ad2417ca8568c2ee02fda826"><div class="ttname"><a href="group__platform___callback.html#ga996d0526ad2417ca8568c2ee02fda826">mbed::callback</a></div><div class="ttdeci">Callback&lt; R()&gt; callback(R(*func)()=0)</div><div class="ttdef"><b>Definition:</b> Callback.h:3842</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
